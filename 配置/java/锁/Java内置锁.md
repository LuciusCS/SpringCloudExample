

`
对象一旦生成了哈希码，它就无法进入偏向锁状态。也就是说，只要一个对象已经计算过哈
 希码，它就无法进入偏向锁状态；当一个对象当前正处于偏向锁状态，并且需要计算其哈希码的话，
 它的偏向锁会被撤销，并且锁会膨胀为重量级锁
`

解释：

1、哈希码（hashCode） 和 偏向锁信息（线程ID） 都存放在 Mark Word 里，而 Mark Word 只有 64 位 —— 空间不够同时放两者！
2、对象膨胀为重量级锁后，Mark Word 被 ptr_to_monitor 覆盖，JVM 会把 hashCode 转移（搬运）到重量级锁结构 ObjectMonitor 中保存


| 状态   | 能否与 hashCode 共存 | 原因                              |
| ---- | --------------- | ------------------------------- |
| 偏向锁  | ❌ 不可以           | Mark Word 里要存线程ID，与 hashCode 冲突 |
| 轻量级锁 | ✅ 可以            | hashCode 临时保存到锁记录中              |
| 重量级锁 | ✅ 可以            | hashCode 保存到 ObjectMonitor 中    |
| 无锁   | ✅ 可以            | hashCode 就在 Mark Word 里         |



什么样的锁支持升级，什么样的锁支持降级

## Synchronized 其实是对 Object 进行的加锁

### 无锁

### 偏向锁

    采用CAS自旋抢占

### 轻量级锁


### 重量级锁


在加锁的过程中，Object上的锁会由 偏向锁升级为 轻量锁，再升级为重量级锁