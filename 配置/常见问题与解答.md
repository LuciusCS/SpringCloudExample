# 常见问题与解答 (FAQ)

## 1. Web 容器选择：Tomcat vs Undertow
**Q: 为什么很多 Spring Boot 开发者选择了 Undertow 而非 Tomcat？**
**A:**
- **Undertow**: 在高并发、非阻塞 I/O 场景（如 WebSocket、大量短连接）下性能更优，内存占用更低。
- **Tomcat**: 成熟稳定，生态最完善，兼容性最好。对于大多数传统业务系统，Tomcat 的稳定性是首选。
- **结论**: 如果追求极致性能且业务场景适合（如网关、高并发 API），可选 Undertow；如果追求稳定和通用性，Tomcat 依然是默认最佳选择。

## 2. 高并发优化
**Q: 如何提升接口并发性能？**
**A:**
1.  **缓存**: 引入 Redis 缓存热点数据，减少数据库压力。
2.  **异步**: 使用消息队列（RabbitMQ/RocketMQ）削峰填谷，将非核心逻辑异步化。
3.  **数据库优化**: 索引优化、SQL 调优、读写分离、分库分表。
4.  **连接池**: 使用 HikariCP，并根据压测结果调整连接数。
5.  **代码层面**: 避免锁竞争，使用无锁数据结构，减少 I/O 阻塞。

**Q: Nginx 与 Nacos 的关系？**
**A:**
- **Nacos**: 服务注册与发现，主要用于微服务**内部**的互相调用（RPC/Feign）。
- **Nginx**: 反向代理和网关，主要用于**外部**流量入口，处理静态资源、SSL 卸载、黑白名单等。
- **配合**: 外部请求 -> Nginx -> Gateway -> 微服务（从 Nacos 获取实例）。

## 3. JVM 与 性能调优
**Q: 现在的服务器配置（核心数、内存）如何影响 JVM 参数？**
**A:**
- **堆内存 (Heap)**: 通常设置为物理内存的 1/2 到 2/3（容器环境下需注意 CGroup 限制）。
- **垃圾回收器 (GC)**:
    - JDK 8: 默认 Parallel GC，大内存推荐 G1。
    - JDK 11/17+: 默认 G1，低延迟场景可选 ZGC。
- **线程数**:
    - CPU 密集型: 核心数 + 1
    - IO 密集型: 核心数 * 2 (或更多，取决于 IO 等待时间)

## 4. 架构与设计
**Q: 项目分层规范？**
**A:**
- **Controller**: 仅处理 Web 请求，参数校验，转换 VO。
- **Service**: 核心业务逻辑，事务控制。
- **DAO/Mapper**: 数据访问。
- **DTO/VO**: 
    - `VO`: 视图对象，展示给前端。
    - `DTO`: 数据传输对象，服务间调用。
    - `DO/Entity`: 数据库实体。

**Q: 为什么 @Component 和 @Service 默认是单例？**
**A:**
Spring 容器默认使用单例模式（Singleton）管理 Bean，是为了减少对象创建销毁的开销，提高性能。只要 Bean 是无状态的（不保存特定用户数据），单例就是线程安全的。

## 5. 其他技术点
- **虚拟线程 (Virtual Threads)**: JDK 21+ 引入，Spring Boot 3.2+ 支持。极大降低了线程开销，适合高并发 IO 密集型任务。
- **MapStruct**: 推荐用于 Java Bean 之间的转换（如 Entity -> DTO），编译期生成代码，性能远超 BeanUtils。
- **RabbitMQ 集群**: 生产环境推荐使用 Quorum Queues（仲裁队列）以保证数据强一致性。
