


##  分布式事务

### 应用场景与实现

| 场景                        | 推荐方案                      | 框架/工具                             | 理由                      |
| ------------------------- | ------------------------- | --------------------------------- | ----------------------- |
| 💰 **电商下单（扣库存、扣余额、创建订单）** | ✅ Seata AT 模式<br>✅ TCC 模式 | Seata、Hmily                       | AT 简单易用，TCC 性能更高        |
| 🧾 **支付、退款（需要幂等与补偿）**     | ✅ TCC 模式                  | Seata TCC、Hmily、ByteTCC           | 精确控制 Try/Confirm/Cancel |
| 📦 **消息通知、异步回调**          | ✅ 本地消息表 / MQ 事务消息         | RocketMQ / Kafka / Outbox Pattern | 高性能、最终一致性               |
| 🧠 **长事务场景（如审批流程、多步骤任务）** | ✅ Saga 模式                 | Seata Saga、LRA                    | 支持编排+补偿逻辑               |
| 🔒 **并发资源控制（防超卖、重复下单）**   | ✅ Redis/Zookeeper 分布式锁    | Redisson / Curator                | 简单轻量，无全局事务              |
| 🏦 **金融核心（必须强一致）**        | ✅ 2PC / XA                | Atomikos、Narayana                 | 强一致要求，牺牲性能              |


### 主流狂击落地比例

在 2024–2025 年的主流 Java 微服务系统中：


| 实现方式                  | 实际使用占比 | 典型应用场景                       |
| --------------------- | ------ | ---------------------------- |
| ✅ **Seata AT 模式**     | ⭐ 60%+ | Spring Cloud、Spring Boot 微服务 |
| ✅ **本地消息表 / MQ 事务消息** | ⭐ 25%  | 电商、积分、异步通知                   |
| ✅ **TCC 模式**          | ⭐ 10%  | 支付、库存、金融类场景                  |
| ✅ **Saga 模式**         | ⭐ 3%   | 流程编排、长事务                     |
| ❌ **XA / 2PC**        | < 2%   | 银行核心、遗留系统                    |


在现代微服务开发中：
最常用：Seata AT 模式（默认方案）
最可靠：消息表 / 事务消息（最终一致性）
最灵活：TCC（高性能补偿逻辑）




## Redis分布式锁