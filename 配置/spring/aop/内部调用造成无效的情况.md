



### @Cacheable åœ¨å†…éƒ¨è°ƒç”¨æ—¶æ— æ•ˆï¼Ÿ
Spring çš„ç¼“å­˜æ˜¯é€šè¿‡ AOP ä»£ç†æœºåˆ¶ å®ç°çš„ï¼š
å½“å¤–éƒ¨ä»£ç è°ƒç”¨ service.getParkOperationsDTOs() æ—¶ï¼ŒSpring æ‹¦æˆªè°ƒç”¨ï¼›
æ£€æŸ¥ @Cacheable æ³¨è§£ï¼›
è‹¥å‘½ä¸­ç¼“å­˜ï¼Œåˆ™ç›´æ¥è¿”å›ç¼“å­˜ç»“æœï¼›
è‹¥æœªå‘½ä¸­ï¼Œåˆ™æ‰§è¡ŒçœŸå®æ–¹æ³•å¹¶ç¼“å­˜ç»“æœã€‚

### 

````

é€šè¿‡ getParkOperationsStatisticsDTOs() è°ƒç”¨ getParkOperationsDTOs()ï¼Œä¸ä¼šç”¨ç¼“å­˜ï¼Œä½†ç»“æœå´è¢«ç¼“å­˜äº†ã€‚ã€
````

```

@Service
public class ParkServiceImpl implements ParkService {

    @Cacheable(cacheNames = CacheConsts.CACHE_DEFAULT, key = "'parkOperations:' + #date")
    public List<ParkOperationsDTO> getParkOperationsDTOs(LocalDate date) {
        System.out.println("==> å®é™…æŸ¥è¯¢æ•°æ®åº“");
        return queryFromDatabase(date);
    }

    public ParkOperationsStatisticsDTO getParkOperationsStatisticsDTOs(LocalDate date) {
        List<ParkOperationsDTO> list = getParkOperationsDTOs(date); // å†…éƒ¨è°ƒç”¨
        ...
    }
}
```

| è¡Œä¸º                 | ç¼“å­˜è¯»å– | ç¼“å­˜å†™å…¥            |
| ------------------ | ---- | --------------- |
| å¤–éƒ¨è°ƒç”¨ï¼ˆproxy.getXxxï¼‰ | âœ… æœ‰æ•ˆ | âœ… æœ‰æ•ˆ            |
| å†…éƒ¨è°ƒç”¨ï¼ˆthis.getXxxï¼‰  | âŒ æ— æ•ˆ | âœ… é€šå¸¸æœ‰æ•ˆï¼ˆæ–¹æ³•æ­£å¸¸æ‰§è¡Œåï¼‰ |
| å¼‚æ­¥è°ƒç”¨ï¼ˆæ–°çº¿ç¨‹ï¼‰          | âŒ æ— æ•ˆ | âŒ æ— æ•ˆï¼ˆé™¤éå–ä»£ç†ï¼‰     |


### æ­£ç¡®çš„åšæ³•
å¦‚æœä½ å¸Œæœ› getParkOperationsStatisticsDTOs() èƒ½é‡ç”¨ç¼“å­˜ï¼ˆå³ â€œè¯»ç¼“å­˜â€ï¼‰ï¼š


```
@Autowired
private ParkService self; // æ³¨å…¥è‡ªèº«ä»£ç†ï¼ˆSpring ä¼šè‡ªåŠ¨æ³¨å…¥ä»£ç†å¯¹è±¡ï¼‰

public ParkOperationsStatisticsDTO getParkOperationsStatisticsDTOs(LocalDate date) throws ExecutionException, InterruptedException {
    List<ParkOperationsDTO> list = self.getParkOperationsDTOs(date); // èµ°ä»£ç†ï¼Œç¼“å­˜ç”Ÿæ•ˆ
    ...
}

```
ğŸ”¸ å†…éƒ¨è°ƒç”¨è·³è¿‡ Spring ä»£ç† â†’ ä¸èµ°ç¼“å­˜è¯»å–é€»è¾‘ï¼›
ğŸ”¸ æ–¹æ³•ä½“ä»ä¼šæ‰§è¡Œ â†’ è¿”å›å€¼ä»å¯èƒ½è¢«ç¼“å­˜ï¼›
ğŸ”¸ è¦æƒ³â€œç”¨ç¼“å­˜â€ï¼Œå¿…é¡»è®©è°ƒç”¨èµ°ä»£ç†ï¼ˆä¾‹å¦‚æ³¨å…¥è‡ªèº« Bean è°ƒç”¨ï¼‰ã€‚


### éªŒè¯æ–¹å¼

ä½ å¯ä»¥æ‰“å°ä¸€ä¸‹çœ‹çœ‹è°ƒç”¨è·¯å¾„ï¼š

```
System.out.println("this = " + this.getClass());
System.out.println("self = " + self.getClass());

```

è¾“å‡ºç±»ä¼¼ï¼š

```
this = class com.xxx.ParkServiceImpl
self = class com.xxx.ParkServiceImpl$$SpringCGLIB$$Proxy

```

###     @Transactional äº‹åŠ¡åœ¨å†…éƒ¨è°ƒç”¨ä¸ç”Ÿæ•ˆ
åŸå› å¦‚ä¸Š


