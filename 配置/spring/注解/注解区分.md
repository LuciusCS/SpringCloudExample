

## `org.springframework.transaction.annotation.Transactional` ä¸`jakarta.transaction.Transactional` ä¹‹é—´çš„åŒºåˆ«

ç‰¹æ€§ / æ³¨è§£	  org.springframework.transaction.annotation.Transactional	   jakarta.transaction.Transactional
æ¥æº	                                Spring                                      Jakarta EE / Java EE
æ”¯æŒçš„äº‹åŠ¡å±æ€§	å®Œæ•´ï¼ˆpropagationã€isolationã€timeoutã€rollbackFor ç­‰ï¼‰     	ç²¾ç®€ï¼ˆTxTypeã€rollbackOn ç­‰ï¼‰
æ¨èç”¨äº	                Spring Boot / Spring Framework é¡¹ç›®	                Java EE / Jakarta EE å®¹å™¨
AOP ä»£ç†æ”¯æŒ	                âœ”ï¸	                                                    âŒ ä¸æ”¯æŒ Spring AOP
ä¸ Spring é›†æˆ         	âœ”ï¸ åŸç”Ÿæ”¯æŒ                                                 	âš ï¸ æœ‰é™æ”¯æŒ
å¯ç”¨æ€§ï¼ˆåŠŸèƒ½å¼ºå¤§æ€§ï¼‰          	é«˜	                                                         è¾ƒä½


åœ¨ Spring é¡¹ç›®ä¸­ï¼Œè¯·å§‹ç»ˆä½¿ç”¨

`import org.springframework.transaction.annotation.Transactional;`



## é¿å…æ³¨è§£æ··ç”¨


| æ³¨è§£å              | Jakarta æ¥æºï¼ˆ`jakarta.inject.*`ï¼‰æˆ– `jakarta.annotation.*` | Spring æ¥æºï¼ˆ`org.springframework.*`ï¼‰                       | æ¨èä½¿ç”¨ï¼ˆSpring é¡¹ç›®ï¼‰             |
| ---------------- | ------------------------------------------------------ | -------------------------------------------------------- | --------------------------- |
| `@Inject`        | `jakarta.inject.Inject`                                | `org.springframework.beans.factory.annotation.Autowired` | âœ… Spring (`@Autowired`)     |
| `@Named`         | `jakarta.inject.Named`                                 | `org.springframework.beans.factory.annotation.Qualifier` | âœ… Spring (`@Qualifier`)     |
| `@Singleton`     | `jakarta.inject.Singleton`                             | `@Scope("singleton")` + `@Component`                     | âœ… Spring (`@Component`)     |
| `@PostConstruct` | `jakarta.annotation.PostConstruct`                     | âŒï¼ˆSpring æ”¯æŒï¼Œä½†é Spring åŸç”Ÿï¼‰                                | âœ… Jakartaï¼Œä½†å¯ç”¨æ„é€ æ³¨å…¥           |
| `@PreDestroy`    | `jakarta.annotation.PreDestroy`                        | âŒ                                                        | âœ… Jakartaï¼Œä½†å¯ç”¨ Spring ç”Ÿå‘½å‘¨æœŸæ¥å£ |

| æ³¨è§£å               | Jakarta æ¥æº (jakarta.validation.*)           | Spring åŒ…å«è½¬å‘         | æ¨èä½¿ç”¨ |
|---------------------|----------------------------------------------|------------------------|
| @NotNull             jakarta.validation.constraints.NotNull         | âœ… Spring æ”¯æŒè½¬å‘     | âœ… ä½¿ç”¨ Jakarta |
| @Valid              | jakarta.validation.Valid                      | âœ… Spring æ”¯æŒ         | âœ… ä½¿ç”¨ Jakarta |
| @Validated          | âŒæ—              | org.springframework.validation.annotation.Validated | âœ… ç”¨ Spring å¤„ç†åˆ†ç»„æ ¡éªŒ |

âœ… æ ¡éªŒæ³¨è§£ä¸€èˆ¬ç”¨ Jakarta çš„ jakarta.validation.constraints.*ï¼Œç»“åˆ Spring çš„ @Validated ä½¿ç”¨ã€‚

| æ³¨è§£                                         | æ¥æº                                                       | æ˜¯å¦ Spring åŸç”Ÿ | æ˜¯å¦æ¨èåœ¨ Spring ä¸­ä½¿ç”¨     | è¯´æ˜                                |
| ------------------------------------------ | -------------------------------------------------------- | ------------ | -------------------- | --------------------------------- |
| `@Autowired`                               | `org.springframework.beans.factory.annotation.Autowired` | âœ”ï¸ æ˜¯         | âœ… **æ¨èä½¿ç”¨**           | æŒ‰ç±»å‹æ³¨å…¥ï¼Œå¯é…åˆ `@Qualifier` æŒ‡å®šåç§°       |
| `@Resource`                                | `jakarta.annotation.Resource`                            | âŒ å¦          | âš ï¸ å¯ç”¨ï¼Œä½†ä¸æ¨è           | æŒ‰åç§°æ³¨å…¥ï¼Œæ”¯æŒ JSR-250                  |
| `@Inject`                                  | `jakarta.inject.Inject`                                  | âŒ å¦          | âš ï¸ å¯ç”¨ï¼Œä½†åŠŸèƒ½è¾ƒå¼±          | æŒ‰ç±»å‹æ³¨å…¥ï¼Œç±»ä¼¼ `@Autowired`ï¼Œæ— æ‰©å±•åŠŸèƒ½       |
| `@Qualifier`                               | `org.springframework.beans.factory.annotation.Qualifier` | âœ”ï¸ æ˜¯         | âœ… é…åˆ `@Autowired` ä½¿ç”¨ | ç”¨äºæŒ‡å®š Bean åç§°ï¼Œè§£å†³å¤šä¸ªåŒç±»å‹ Bean å†²çª      |
| `@Value`                                   | `org.springframework.beans.factory.annotation.Value`     | âœ”ï¸ æ˜¯         | âœ… æ³¨å…¥é…ç½®å€¼              | æ³¨å…¥ application.properties ä¸­çš„å€¼æˆ–è¡¨è¾¾å¼ |
| `@Component`                               | `org.springframework.stereotype.Component`               | âœ”ï¸ æ˜¯         | âœ… æ³¨å†Œ Bean            | ç”¨äºæ ‡è®°ç±»ä¸ºç»„ä»¶                          |
| `@Service` / `@Repository` / `@Controller` | Spring æ´¾ç”Ÿæ³¨è§£                                              | âœ”ï¸ æ˜¯         | âœ… è¡¨ç¤ºä¸åŒè§’è‰²çš„ç»„ä»¶          | è¯­ä¹‰æ˜ç¡®ï¼Œä¾¿äºåˆ†å±‚ç®¡ç†                       |



| æ³¨è§£           | ç”¨é€”                 | æ¨èç­‰çº§ï¼ˆSpring é¡¹ç›®ï¼‰ |
| ------------ | ------------------ | --------------- |
| `@Autowired` | ä¸»åŠ›ä¾èµ–æ³¨å…¥å·¥å…·           | â­â­â­â­â­ï¼ˆå¼ºçƒˆæ¨èï¼‰     |
| `@Qualifier` | æŒ‡å®šåç§°ï¼ˆé…åˆ Autowiredï¼‰ | â­â­â­â­            |
| `@Resource`  | JSR-250 è§„èŒƒï¼ŒæŒ‰åç§°æ³¨å…¥   | â­â­ï¼ˆå…¼å®¹ç”¨ï¼‰         |
| `@Inject`    | JSR-330 è§„èŒƒï¼ŒæŒ‰ç±»å‹æ³¨å…¥   | â­â­ï¼ˆä¸æ¨èæ‰©å±•æ€§å·®ï¼‰     |
| `@Value`     | é…ç½®å€¼æ³¨å…¥              | â­â­â­â­ï¼ˆå¸¸ç”¨ï¼‰        |


## æ€»ç»“æ¨èåŸåˆ™ï¼ˆSpring é¡¹ç›®ä¸­ï¼‰ï¼š
### ğŸ”¹ ä½¿ç”¨ Spring æ³¨è§£ çš„åœºæ™¯ï¼š
äº‹åŠ¡æ§åˆ¶ï¼š@Transactional â€” ç”¨ Spring çš„
ä¾èµ–æ³¨å…¥ï¼š@Autowired, @Qualifier, @Value, @Component, @Service, @Repository, @Controller
äº‹ä»¶ç›‘å¬ï¼š@EventListener
é…ç½®ç±»ï¼š@Configuration, @Bean, @PropertySource, @Profile
AOPç›¸å…³ï¼š@Aspect, @Around, @Before, @After, @AfterReturning, @AfterThrowing
éªŒè¯ï¼š@Validatedï¼ˆé…åˆ jakarta.validation çš„ @NotNull ç­‰ï¼‰
### ğŸ”¸ ä½¿ç”¨ Jakarta æ³¨è§£ çš„åœºæ™¯ï¼ˆä¸»è¦æ˜¯ JPAï¼‰ï¼š
å®ä½“ç±»æ˜ å°„ï¼ˆORMï¼‰ï¼š
@Entity, @Table, @Column, @Id, @GeneratedValue, @ManyToOne, @JoinColumn, ç­‰ç­‰
ç”Ÿå‘½å‘¨æœŸï¼ˆå¦‚ @PostConstructã€@PreDestroyï¼‰å¯ä¿ç•™ï¼Œä½† Spring æ¨èç”¨æ„é€ å‡½æ•°æ³¨å…¥



## @Controller vs. @RestController çš„æ ¸å¿ƒåŒºåˆ«

| ç‰¹æ€§                     | `@Controller`                               | `@RestController`                                        |
| ---------------------- | ------------------------------------------- | -------------------------------------------------------- |
| æ³¨è§£æ¥æº                   | `org.springframework.stereotype.Controller` | `org.springframework.web.bind.annotation.RestController` |
| é»˜è®¤è¿”å›è¡Œä¸º                 | è¿”å›è§†å›¾åç§°ï¼ˆJSP/Thymeleaf ç­‰ï¼‰                     | è¿”å› JSON / XMLï¼ˆå³å“åº”ä½“ï¼‰                                      |
| æ˜¯å¦è‡ªåŠ¨æ·»åŠ  `@ResponseBody` | âŒ éœ€è¦æ‰‹åŠ¨åŠ                                      | âœ… è‡ªåŠ¨åŠ åˆ°æ‰€æœ‰æ–¹æ³•                                               |
| å…¸å‹ç”¨é€”                   | é¡µé¢æ¸²æŸ“ï¼ˆWeb å‰ç«¯ã€æ¨¡æ¿å¼•æ“ï¼‰                           | æä¾› REST APIã€JSON æ¥å£                                      |
| ä½¿ç”¨è§†å›¾è§£æå™¨ï¼ˆViewResolverï¼‰  | âœ… æ˜¯                                         | âŒ å¦                                                      |


ä½¿ç”¨ @Controller çš„æƒ…å†µï¼š
```
@Controller
public class PageController {

    @GetMapping("/home")
    public String home(Model model) {
        model.addAttribute("user", "Lucius");
        return "home";  // è·³è½¬åˆ° home.html æˆ– home.jsp
    }
}

```

ä½¿ç”¨ @RestController çš„æƒ…å†µï¼š

```
@RestController
public class ApiController {

    @GetMapping("/api/user")
    public UserDTO getUser() {
        return new UserDTO("lucius", 30);
    }
}
```




import jakarta.persistence.Id; å’Œ import org.springframework.data.annotation.Id; åŒºåˆ†

| **ç‰¹æ€§**                     | **`@Id` (æ¥è‡ª `jakarta.persistence`)**                              | **`@Id` (æ¥è‡ª `org.springframework.data.annotation`)**           |
| -------------------------- | ----------------------------------------------------------------- | -------------------------------------------------------------- |
| **ä½¿ç”¨åœºæ™¯**                   | ç”¨äº **JPA**ï¼ˆJava Persistence APIï¼‰ä¸­ï¼Œè¡¨ç¤ºå®ä½“ç±»çš„ä¸»é”®å­—æ®µï¼Œé€šå¸¸ç”¨äºå…³ç³»å‹æ•°æ®åº“ï¼ˆå¦‚ MySQLï¼‰ã€‚ | ç”¨äº **Spring Data** ä¸­ï¼Œè¡¨ç¤ºä¸»é”®å­—æ®µï¼Œé€šå¸¸ç”¨äºéå…³ç³»å‹æ•°æ®åº“ï¼ˆå¦‚ MongoDBï¼‰ã€‚            |
| **æ•°æ®åº“ç±»å‹**                  | ä¸»è¦ç”¨äº **å…³ç³»å‹æ•°æ®åº“**ï¼ˆå¦‚ MySQL, PostgreSQL ç­‰ï¼‰                            | ä¸»è¦ç”¨äº **éå…³ç³»å‹æ•°æ®åº“**ï¼ˆå¦‚ MongoDB, Redis ç­‰ï¼‰                           |
| **ä¾èµ–åº“**                    | ä¾èµ–äº JPA å®ç°ï¼ˆå¦‚ Hibernateï¼‰ï¼Œéœ€è¦ **`jakarta.persistence`** APIã€‚         | ä¾èµ–äº Spring Data é¡¹ç›®ï¼ˆå¦‚ `spring-data-mongodb`ã€`spring-data-jpa`ï¼‰ã€‚ |
| **æ³¨è§£æ¥æº**                   | `jakarta.persistence.Id`                                          | `org.springframework.data.annotation.Id`                       |
| **é€‚ç”¨å¯¹è±¡**                   | **JPA å®ä½“ç±»**ï¼Œé€šå¸¸ä¸æ•°æ®åº“è¡¨å­—æ®µæ˜ å°„                                           | **Spring Data** ä¸­çš„ **å®ä½“ç±»**ï¼Œé€šå¸¸ä¸æ•°æ®åº“æ–‡æ¡£ï¼ˆå¦‚ MongoDBï¼‰æ˜ å°„               |
| **å…¸å‹ç¤ºä¾‹**                   | `@Entity` + `@Id` ç»“åˆä½¿ç”¨ï¼Œæ ‡è¯† JPA å®ä½“ç±»çš„ä¸»é”®å­—æ®µ                            | ç”¨äºæ ‡è¯† MongoDB æ–‡æ¡£ï¼ˆæˆ–å…¶ä»– NoSQL æ•°æ®åº“ï¼‰çš„ä¸»é”®å­—æ®µ                            |
| **æŒä¹…åŒ–æ¡†æ¶**                  | **JPAï¼ˆHibernateï¼‰**                                                | **Spring Dataï¼ˆå¦‚ MongoDBï¼‰**                                     |
| **æ˜¯å¦ä¾èµ–äºæ•°æ®åº“è¡¨/åˆ—æ˜ å°„**          | ä¾èµ–æ•°æ®åº“è¡¨çš„æ˜ å°„ï¼Œä¸»é”®å­—æ®µå¯¹åº”æ•°æ®åº“ä¸­çš„åˆ—                                            | ä¾èµ–äº MongoDB ç­‰æ•°æ®åº“çš„æ–‡æ¡£æ¨¡å‹ï¼Œä¸»é”®å­—æ®µå¯¹åº”æ•°æ®åº“ä¸­çš„æ–‡æ¡£ ID                         |
| **ç¤ºä¾‹ä»£ç **                   | \`\`\`java                                                        | \`\`\`java                                                     |
|                            | @Entity                                                           | public class User {                                            |
|                            | public class User {                                               | @Id                                                            |
|                            | @Id                                                               | private String id;                                             |
|                            | private Long id;                                                  | private String name;                                           |
|                            | private String name;                                              | // getters and setters                                         |
|                            | }                                                                 | }                                                              |
| **JPA / Spring Data é…åˆä½¿ç”¨** | é…åˆ **JPA** æ¡†æ¶è¿›è¡Œæ•°æ®æŒä¹…åŒ–ï¼Œé€šå¸¸ä¸å…³ç³»å‹æ•°æ®åº“ä¸€èµ·ä½¿ç”¨                                | é…åˆ **Spring Data** æ¡†æ¶è¿›è¡Œæ•°æ®æŒä¹…åŒ–ï¼Œé€šå¸¸ä¸ NoSQL æ•°æ®åº“ä¸€èµ·ä½¿ç”¨                 |

æ€»ç»“ï¼š
å¦‚æœä½ çš„åº”ç”¨æ˜¯åŸºäº å…³ç³»å‹æ•°æ®åº“ ä¸”ä½¿ç”¨ JPAï¼Œä½ åº”è¯¥ä½¿ç”¨ jakarta.persistence.Idã€‚
å¦‚æœä½ çš„åº”ç”¨æ˜¯åŸºäº Spring Data å’Œ éå…³ç³»å‹æ•°æ®åº“ï¼ˆå¦‚ MongoDBã€Cassandra ç­‰ï¼‰ï¼Œä½ åº”è¯¥ä½¿ç”¨ org.springframework.data.annotation.Idã€‚