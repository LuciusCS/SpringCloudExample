

Sentinel é€‚ç”¨äº é™æµã€ç½‘å…³æµæ§ã€åŠ¨æ€è§„åˆ™ç®¡ç†ã€‚
Resilience4j é€‚ç”¨äº ç†”æ–­ã€é™çº§ã€çº¿ç¨‹éš”ç¦»ã€é‡è¯•ã€‚Netflix Hystrix æ›¿ä»£è€…ï¼Œæä¾› ç†”æ–­ã€é™æµã€é‡è¯•ã€ç¼“å­˜ï¼Œè½»é‡çº§ã€åŸºäº Java 8 å‡½æ•°å¼ç¼–ç¨‹
ğŸš€ å¦‚æœä½ ç”¨ Spring Cloud Alibabaï¼Œæ¨è Sentinelï¼
ğŸš€ å¦‚æœä½ ç”¨ Spring Cloud å®˜æ–¹ç»„ä»¶ï¼Œæ¨è Resilience4jï¼


å¯¹æ¯”é¡¹             	é™æµï¼ˆRate Limitingï¼‰	            ç†”æ–­ï¼ˆCircuit Breakerï¼‰
ç›®çš„              	æ§åˆ¶æµé‡ï¼Œé˜²æ­¢ç³»ç»Ÿè¶…è½½	                æ•…éšœéš”ç¦»ï¼Œé˜²æ­¢é›ªå´©
è§¦å‘æ¡ä»¶	               é«˜å¹¶å‘è¯·æ±‚è¶…è¿‡é˜ˆå€¼	               ä¾èµ–æœåŠ¡å¼‚å¸¸ï¼Œå¦‚è¶…æ—¶æˆ–é«˜é”™è¯¯ç‡
ç­–ç•¥                  	ä¸¢å¼ƒè¶…å‡ºè¯·æ±‚	                        åˆ‡æ–­æµé‡ï¼Œæä¾›é™çº§
å…¸å‹ç®—æ³•            	ä»¤ç‰Œæ¡¶ã€æ¼æ¡¶ã€æ»‘åŠ¨çª—å£	            ç†”æ–­å™¨çŠ¶æ€æœºï¼ˆClosed â†’ Open â†’ Half-Openï¼‰
é€‚ç”¨åœºæ™¯	            API ç½‘å…³ã€é™æµç­–ç•¥ã€é˜²çˆ¬è™«	            ä¾èµ–æœåŠ¡ä¸å¯ç”¨ã€é›ªå´©é˜²æŠ¤
å®ç°æ–¹å¼	            Redisã€Spring Cloud Gateway	        Sentinelã€Resilience4j



å¦‚æœæ¥å£é«˜å¹¶å‘ï¼Œå…ˆé™æµ**ï¼Œé¿å…æµé‡æ‰“çˆ†æœåŠ¡**
å¦‚æœæ¥å£è®¿é—®çš„ä¸‹æ¸¸æœåŠ¡ä¸ç¨³å®šï¼Œå¯ç”¨ç†”æ–­**ï¼Œé˜²æ­¢çº§è”æ•…éšœ**
Spring Cloud Gateway é™æµ + Sentinel ç†”æ–­ï¼Œæœ€ä½³å®è·µ

ç”¨æˆ·è¯·æ±‚å¤ªå¤šï¼Ÿé™æµï¼ï¼ˆæ§åˆ¶è®¿é—®é¢‘ç‡ï¼‰
ä¸‹æ¸¸æœåŠ¡æ•…éšœï¼Ÿç†”æ–­ï¼ï¼ˆé˜²æ­¢æ•…éšœæ‰©æ•£ï¼‰
ä¸¤è€…å¯ä»¥ç»“åˆï¼Œæå‡ç³»ç»Ÿç¨³å®šæ€§ ğŸš€


ç»„ä»¶                      ä¸»è¦ç”¨é€”	                é€‚ç”¨æ¶æ„	                        ç‰¹ç‚¹
Redisson é™æµ	åŸºäº Redis å®ç°çš„åˆ†å¸ƒå¼é™æµ	å¾®æœåŠ¡ / ç½‘å…³ / å•ä½“	        è½»é‡çº§ã€æ”¯æŒ Redis Clusterã€é€‚åˆé«˜å¹¶å‘åœºæ™¯
Sentinel	    æµé‡æ§åˆ¶ã€ç†”æ–­é™çº§	            å¾®æœåŠ¡ã€Spring Cloud	        é˜¿é‡Œå¼€æºã€æ”¯æŒåˆ†å¸ƒå¼é™æµã€å†…ç½®æ§åˆ¶å°
Resilience4j	ç†”æ–­ã€é™æµã€é‡è¯•ã€è¶…æ—¶æ§åˆ¶	Java å•ä½“ / Spring Cloud å¾®æœåŠ¡	è½»é‡çº§ã€æœ¬åœ°é™æµã€é€‚åˆå•ä½“åº”ç”¨

## Resilience4j   vs Sentinel

Resilience4j + CircuitBreaker å’Œ Sentinel åœ¨ç†”æ–­ï¼ˆä»¥åŠé™æµã€é™çº§ç­‰åŠŸèƒ½ï¼‰æ–¹é¢ç¡®å®æ˜¯ç±»ä¼¼çš„

| ç‰¹æ€§                    | **Resilience4j + CircuitBreaker**                          | **Sentinel**                                    |
| --------------------- |---------------------------------------------------------  ---| ----------------------------------------------- |
| **ç†”æ–­åŠŸèƒ½**              | âœ… æä¾›ç†”æ–­åŠŸèƒ½ï¼ŒåŸºäºå¤±è´¥ç‡ã€è¯·æ±‚æ•°ç­‰æ¡ä»¶è‡ªåŠ¨æ–­å¼€æœåŠ¡              | âœ… æä¾›ç†”æ–­åŠŸèƒ½ï¼Œè‡ªåŠ¨åˆ¤æ–­æœåŠ¡è°ƒç”¨æ˜¯å¦å¥åº·                           |
| **é™æµåŠŸèƒ½**              | âœ… æä¾›é™æµåŠŸèƒ½ï¼Œå¯ä»¥è®¾ç½®åŸºäº QPS æˆ–å¹¶å‘çº¿ç¨‹æ•°çš„æµé‡æ§åˆ¶           | âœ… æä¾›é™æµåŠŸèƒ½ï¼Œæ”¯æŒ QPSã€çº¿ç¨‹æ•°ç­‰å¤šç»´åº¦æ§åˆ¶                       |
| **é™çº§åŠŸèƒ½**              | âœ… æ”¯æŒæœåŠ¡é™çº§ï¼Œå¤±è´¥æ—¶è¿”å›é»˜è®¤å€¼æˆ–å…¶ä»–é€»è¾‘                       | âœ… æ”¯æŒæœåŠ¡é™çº§ï¼Œå¤±è´¥æ—¶è¿”å›é»˜è®¤å€¼æˆ–é€šè¿‡è§„åˆ™å¤„ç†                        |
| **åŠ¨æ€é…ç½®æ”¯æŒ**           | âŒ éœ€è¦é¢å¤–é…ç½®å’Œç®¡ç†ï¼Œä¾‹å¦‚é€šè¿‡ä»£ç é…ç½®ç†”æ–­è§„åˆ™                   | âœ… æ”¯æŒé€šè¿‡æ§åˆ¶å°æˆ–åŠ¨æ€é…ç½®æ›´æ–°ç†”æ–­è§„åˆ™                            |
| **ç­–ç•¥çµæ´»æ€§**             | âœ… æä¾›è¯¦ç»†çš„ç†”æ–­è§„åˆ™å’Œè‡ªå®šä¹‰é…ç½®ï¼Œçµæ´»æ€§è¾ƒé«˜                     | âœ… æä¾›å¤šç§ç»†ç²’åº¦çš„è§„åˆ™æ§åˆ¶ï¼Œå¯ä»¥åŸºäºèµ„æºã€æ¥å£ã€æ–¹æ³•ç­‰å¤šç»´åº¦è¿›è¡Œé…ç½®             |
| **é›†æˆå¤æ‚åº¦**             | âœ… éœ€è¦å¼€å‘è€…æ‰‹åŠ¨é…ç½®ï¼Œçµæ´»ä½†ç›¸å¯¹è¾ƒå¤æ‚                            âœ… æ˜“äºé›†æˆï¼Œå°¤å…¶é€‚åˆå¤æ‚åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¿æŠ¤ï¼Œé…ç½®ç®€ä¾¿                      |
| **é€‚ç”¨åœºæ™¯**              | é€‚ç”¨äºéœ€è¦çµæ´»ã€å¯å®šåˆ¶çš„ç†”æ–­ã€é™æµã€é‡è¯•æœºåˆ¶çš„ç³»ç»Ÿ                  | é€‚ç”¨äºå¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå°¤å…¶æ˜¯éœ€è¦ç»†ç²’åº¦æ§åˆ¶çš„é«˜å¹¶å‘åœºæ™¯                    |
| **ä¸ Spring Cloud é›†æˆ**  | âœ… æä¾› `spring-cloud-starter-circuitbreaker-resilience4j` é›†æˆ | âœ… æä¾› `spring-cloud-starter-alibaba-sentinel` é›†æˆ |
| **ç†”æ–­å™¨çš„å¼€å…³æ§åˆ¶**         | é€šè¿‡ `CircuitBreaker` æ³¨è§£å’Œç­–ç•¥è¿›è¡Œæ§åˆ¶                       | é€šè¿‡ `@SentinelResource` æ³¨è§£è¿›è¡Œæ§åˆ¶                   |
| **ç›‘æ§ä¸å¯è§†åŒ–**            | âŒ é»˜è®¤ä¸æ”¯æŒç›‘æ§å’Œå¯è§†åŒ–ï¼Œéœ€è¦é›†æˆå…¶ä»–ç›‘æ§å·¥å…·                     | âœ… æä¾›å†…å»ºçš„æ§åˆ¶å°ï¼Œæ”¯æŒæœåŠ¡è°ƒç”¨çš„å®æ—¶ç›‘æ§å’ŒåŠ¨æ€è§„åˆ™è°ƒæ•´                   |


1ã€Resilience4j æä¾›çš„æ˜¯ä¸€ä¸ª ç‹¬ç«‹çš„ç†”æ–­å™¨ï¼Œåœ¨ Feign è°ƒç”¨æ—¶ï¼Œä½ éœ€è¦æ˜¾å¼åœ°å¯ç”¨ CircuitBreaker æ¥åº”ç”¨ç†”æ–­é€»è¾‘ã€‚
å¦‚æœä½ åœ¨ Feign ä¸­ä½¿ç”¨ Resilience4jï¼Œä½ éœ€è¦é…ç½® CircuitBreakerï¼Œå¹¶é€šè¿‡ AOP æˆ–æ³¨è§£æ¥æ§åˆ¶ç†”æ–­è§„åˆ™ã€‚
Resilience4j å¿…é¡»æ˜ç¡®ä½¿ç”¨ CircuitBreaker æ¥æ§åˆ¶ç†”æ–­è¡Œä¸ºã€‚
```
feign:
  circuitbreaker:
    enabled: true  # å¯ç”¨ Resilience4j CircuitBreaker
```

```
@FeignClient(name = "user-service", fallback = UserServiceFallback.class)
public interface UserServiceClient {

    @CircuitBreaker(name = "userService", fallbackMethod = "fallbackGetUser")
    @GetMapping("/users/{id}")
    User getUser(@PathVariable("id") Long id);

    default User fallbackGetUser(Long id, Throwable t) {
        return new User(id, "Fallback User");
    }
}
```

2ã€ Sentinel çš„å·¥ä½œæœºåˆ¶ä¸ Resilience4j çš„ä¸åŒï¼Œå®ƒåœ¨ æœåŠ¡ä¿æŠ¤å±‚é›†æˆäº† ç†”æ–­ã€é™æµã€é™çº§ ç­‰å¤šç§åŠŸèƒ½ã€‚
é€šè¿‡ æ³¨è§£ï¼ˆä¾‹å¦‚ @SentinelResourceï¼‰ï¼ŒSentinel å¯ä»¥ç›´æ¥åœ¨ Feign ä¸­å¯ç”¨ï¼Œå¹¶é€šè¿‡é…ç½®æ–‡ä»¶æˆ–æ§åˆ¶å°æ¥åŠ¨æ€æ§åˆ¶ç­–ç•¥ï¼Œ
æ— éœ€é¢å¤–é…ç½® CircuitBreakerã€‚ ä½¿ç”¨ Sentinel æ—¶ï¼Œæ— éœ€æ˜¾å¼é…ç½®ç†”æ–­å™¨ï¼Œåªéœ€è¦ç”¨ @SentinelResource æ³¨è§£æ¥æŒ‡å®šç†”æ–­è§„åˆ™ï¼š

```
@FeignClient(name = "user-service", fallback = UserServiceFallback.class)
public interface UserServiceClient {

    @SentinelResource(value = "getUser", fallback = "fallbackGetUser")
    @GetMapping("/users/{id}")
    User getUser(@PathVariable("id") Long id);

    default User fallbackGetUser(Long id, Throwable t) {
        return new User(id, "Fallback User");
    }
}
```
Sentinel çš„ @SentinelResource æ³¨è§£ï¼šSentinel ä¼šè‡ªåŠ¨ä¸º Feign æ–¹æ³•æä¾›ç†”æ–­ã€é™çº§ç­‰åŠŸèƒ½ï¼Œè€Œæ— éœ€é¢å¤–é…ç½®ã€‚
CircuitBreaker ä¸æ˜¯å¿…éœ€çš„ï¼Œå› ä¸º Sentinel è‡ªå¸¦ç†”æ–­æœºåˆ¶ã€‚
